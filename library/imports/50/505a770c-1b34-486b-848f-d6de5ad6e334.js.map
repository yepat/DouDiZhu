{"version":3,"sources":["../../../../assets/Script/assets/Script/topBarControl.js"],"names":["config","require","EventHelper","PlayerDetailModel","dialogManager","cc","Class","extends","Component","properties","headImg","default","type","Sprite","playerName","Label","playerLevel","playerLedou","playerLeQuan","start","self","setHeadUrl","nickname","getNickName","setNickName","parseString","setLevel","getTitle","setLeDou","getCoin","setLuQuan","getCoupon","AddCustomEvent","MyNode","onRefreshDataResult","onRepeatLogin","onDestroy","console","log","event","data","getUserData","showCommonDialog","isShow","director","loadScene","payload","coins","setCoin","coupon","setCoupon","lottery","setLottery","mail_unread","setMailUnread","weichatgame_task_unaward","setTaskUnReward","weichatgame_invite_unaward","setShareUnReward","checkin_undo","setCheckinUndo","task1_unaward","setTask1Unaward","task2_unaward","setTask2Unaward","charge_rate","setChargeRate","propDress","setPropDress","propItems","setPropItems","imgUrl","wxInfo","avatarUrl","headUrl","getGender","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","load","texture","name","string","lv","number","Math","floor","headClick","args","showPlayerInfo","vv","audioMgr","playSFX"],"mappings":"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","file":"topBarControl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\nvar config = require(\"config\");\nvar EventHelper = require(\"EventHelper\");\nvar PlayerDetailModel = require(\"PlayerDetailModel\");\nvar dialogManager = require(\"dialogManager\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        headImg : {\n            default : null,\n            type : cc.Sprite\n        },\n        playerName : {\n            default : null,\n            type : cc.Label\n        },\n        playerLevel : {\n            default : null,\n            type : cc.Label\n        },\n        playerLedou : {\n            default : null,\n            type : cc.Label\n        },\n        playerLeQuan : {\n            default : null,\n            type : cc.Label\n        }\n    },\n    // onLoad () {},\n    start () {\n        var self = this;\n        self.setHeadUrl();\n        var nickname = PlayerDetailModel.getNickName();\n        self.setNickName(config.parseString(nickname,5));\n        self.setLevel(PlayerDetailModel.getTitle());\n        self.setLeDou(PlayerDetailModel.getCoin());\n        self.setLuQuan(PlayerDetailModel.getCoupon());\n\n        EventHelper.AddCustomEvent(config.MyNode,\"RefreshDataResult\",self.onRefreshDataResult,self);\n        EventHelper.AddCustomEvent(config.MyNode,\"RepeatLogin\",self.onRepeatLogin,self);   \n    },\n    onDestroy(){\n        console.log(\" topBar Destroy\");\n    },\n    onRepeatLogin(event){\n        console.log(\"您的账号已经在其他地方登陆！\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n        dialogManager.showCommonDialog(\"提示\",\"您的账号已经在其他地方登陆！\",function(){\n            self.isShow = false;\n            cc.director.loadScene(\"LoadingScene\");\n        });\n    },\n    onRefreshDataResult(event){\n        console.log(\"刷新用户信息数据1111------\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n\n        var payload = data;\n        // var model = app:getModel(\"PlayerDetailModel\")\n        //用户乐豆数\n        if (payload.data && payload.data.coins){\n            PlayerDetailModel.setCoin(payload.data.coins)\n            self.setLeDou(PlayerDetailModel.getCoin());\n        }\n        //用户奖券数\n        if (payload.data && payload.data.coupon){\n            PlayerDetailModel.setCoupon(payload.data.coupon)\n            self.setLuQuan(PlayerDetailModel.getCoupon());\n        }\n        //用户抽奖数\n        if (payload.data && payload.data.lottery){\n            PlayerDetailModel.setLottery(payload.data.lottery)\n        }\n        //未读邮件数\n        if (payload.data && payload.data.mail_unread){\n            PlayerDetailModel.setMailUnread(payload.data.mail_unread)\n        }\n        //未领取任务数\n        if (payload.data && payload.data.weichatgame_task_unaward){\n            PlayerDetailModel.setTaskUnReward(payload.data.weichatgame_task_unaward)\n        }\n        //未领取分享数\n        if (payload.data && payload.data.weichatgame_invite_unaward){\n            PlayerDetailModel.setShareUnReward(payload.data.weichatgame_invite_unaward)\n        }\n\n        //0不可签到, 1可以签到\n        if (payload.data && payload.data.checkin_undo){\n            PlayerDetailModel.setCheckinUndo(payload.data.checkin_undo)\n        }\n        //可领奖的每日任务数\n        if (payload.data && payload.data.task1_unaward){\n            PlayerDetailModel.setTask1Unaward(payload.data.task1_unaward);\n        }\n        //可领奖的成长任务数\n        if (payload.data && payload.data.task2_unaward){\n            PlayerDetailModel.setTask2Unaward(payload.data.task2_unaward);\n        }\n        //充值奖励利率\n        if (payload.data && payload.data.charge_rate){\n            PlayerDetailModel.setChargeRate(payload.data.charge_rate);\n        }\n        //皮肤\n        if (payload.data && payload.data.propDress){\n            PlayerDetailModel.setPropDress(payload.data.propDress);\n        }\n        //道具\n        if (payload.data && payload.data.propItems){\n            PlayerDetailModel.setPropItems(payload.data.propItems);\n        }\n    },\n    setHeadUrl(){\n        var self = this;\n         //设置微信头像\n         var imgUrl=config.wxInfo.avatarUrl;\n\n         if(imgUrl==\"\"){\n            var headUrl = \"p_head_woman\";\n            if(PlayerDetailModel.getGender() == 1){\n                headUrl = \"p_head_man\";\n            }\n            cc.loader.loadRes(headUrl,cc.SpriteFrame,function(err,spriteFrame){\n                self.headImg.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n            });\n            return;\n        }\n\n        imgUrl = imgUrl + \"?aa=aa.jpg\";\n        cc.loader.load(imgUrl, function(err, texture){\n            self.headImg.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n        });\n    },\n    setNickName(name){\n         //修改昵称\n         this.playerName.string = name;\n    },\n    setLevel(lv){\n        //修改等级\n        this.playerLevel.string = lv;\n    },\n    setLeDou(number){\n        //修改乐豆数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLedou.string = \"\"+number+\"万\";\n        }else{\n            this.playerLedou.string = \"\"+number;\n        }\n        \n    },\n    setLuQuan(number){\n        //修改乐券数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLeQuan.string = \"\"+number+\"万\";\n        }else{\n            this.playerLeQuan.string = \"\"+number;\n        }\n    },\n    //点击头像\n    headClick(){\n        var args = \"hall\";\n        dialogManager.showPlayerInfo(args);\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    }\n});\n"]}