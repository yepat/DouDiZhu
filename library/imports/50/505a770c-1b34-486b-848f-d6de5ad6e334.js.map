{"version":3,"sources":["../../../../assets/Script/assets/Script/topBarControl.js"],"names":["config","require","EventHelper","PlayerDetailModel","dialogManager","cc","Class","extends","Component","properties","headImg","default","type","Sprite","playerName","Label","playerLevel","playerLedou","playerLeQuan","start","self","setHeadUrl","nickname","getNickName","setNickName","parseString","setLevel","getTitle","setLeDou","getCoin","setLuQuan","getCoupon","AddCustomEvent","MyNode","onRefreshDataResult","onRepeatLogin","onDestroy","console","log","RemoveCustomEvent","event","data","getUserData","showCommonDialog","isShow","vv","audioMgr","stopMusic","director","loadScene","payload","coins","setCoin","leDouShareSucss","list","args","arg1","arg2","push","showAnimGetProp","coupon","setCoupon","lottery","setLottery","mail_unread","setMailUnread","weichatgame_task_unaward","setTaskUnReward","weichatgame_invite_unaward","setShareUnReward","checkin_undo","setCheckinUndo","task1_unaward","setTask1Unaward","task2_unaward","setTask2Unaward","charge_rate","setChargeRate","propDress","setPropDress","propItems","setPropItems","imgUrl","wxInfo","avatarUrl","headUrl","getGender","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","load","texture","name","string","lv","number","Math","floor","headClick","showPlayerInfo","playSFX"],"mappings":";;;;;;AACA,IAAIA,SAASC,QAAQ,QAAR,CAAb;AACA,IAAIC,cAAcD,QAAQ,aAAR,CAAlB;AACA,IAAIE,oBAAoBF,QAAQ,mBAAR,CAAxB;AACA,IAAIG,gBAAgBH,QAAQ,eAAR,CAApB;;AAEAI,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACRC,iBAAU;AACNC,qBAAU,IADJ;AAENC,kBAAOP,GAAGQ;AAFJ,SADF;AAKRC,oBAAa;AACTH,qBAAU,IADD;AAETC,kBAAOP,GAAGU;AAFD,SALL;AASRC,qBAAc;AACVL,qBAAU,IADA;AAEVC,kBAAOP,GAAGU;AAFA,SATN;AAaRE,qBAAc;AACVN,qBAAU,IADA;AAEVC,kBAAOP,GAAGU;AAFA,SAbN;AAiBRG,sBAAe;AACXP,qBAAU,IADC;AAEXC,kBAAOP,GAAGU;AAFC;AAjBP,KAHP;AAyBL;AACAI,SA1BK,mBA0BI;AACL,YAAIC,OAAO,IAAX;AACAA,aAAKC,UAAL;AACA,YAAIC,WAAWnB,kBAAkBoB,WAAlB,EAAf;AACAH,aAAKI,WAAL,CAAiBxB,OAAOyB,WAAP,CAAmBH,QAAnB,EAA4B,CAA5B,CAAjB;AACAF,aAAKM,QAAL,CAAcvB,kBAAkBwB,QAAlB,EAAd;AACAP,aAAKQ,QAAL,CAAczB,kBAAkB0B,OAAlB,EAAd;AACAT,aAAKU,SAAL,CAAe3B,kBAAkB4B,SAAlB,EAAf;;AAEA7B,oBAAY8B,cAAZ,CAA2BhC,OAAOiC,MAAlC,EAAyC,mBAAzC,EAA6Db,KAAKc,mBAAlE,EAAsFd,IAAtF;AACAlB,oBAAY8B,cAAZ,CAA2BhC,OAAOiC,MAAlC,EAAyC,aAAzC,EAAuDb,KAAKe,aAA5D,EAA0Ef,IAA1E;AACA;AACH,KAtCI;AAuCLgB,aAvCK,uBAuCM;AACPC,gBAAQC,GAAR,CAAY,iBAAZ;AACA,YAAIlB,OAAO,IAAX;AACAlB,oBAAYqC,iBAAZ,CAA8BvC,OAAOiC,MAArC,EAA4C,mBAA5C,EAAgEb,KAAKc,mBAArE,EAAyFd,IAAzF;AACAlB,oBAAYqC,iBAAZ,CAA8BvC,OAAOiC,MAArC,EAA4C,aAA5C,EAA0Db,KAAKe,aAA/D,EAA6Ef,IAA7E;AACH,KA5CI;AA6CLe,iBA7CK,yBA6CSK,KA7CT,EA6Ce;AAChBH,gBAAQC,GAAR,CAAY,gBAAZ;AACA,YAAIlB,OAAO,IAAX;AACA,YAAIqB,OAAOD,MAAME,WAAN,EAAX;AACAL,gBAAQC,GAAR,CAAYG,IAAZ;AACArC,sBAAcuC,gBAAd,CAA+B,IAA/B,EAAoC,gBAApC,EAAqD,YAAU;AAC3DvB,iBAAKwB,MAAL,GAAc,KAAd;AACAvC,eAAGwC,EAAH,CAAMC,QAAN,CAAeC,SAAf;AACA1C,eAAG2C,QAAH,CAAYC,SAAZ,CAAsB,cAAtB;AACH,SAJD;AAKH,KAvDI;AAwDLf,uBAxDK,+BAwDeM,KAxDf,EAwDqB;AACtBH,gBAAQC,GAAR,CAAY,oBAAZ;AACA,YAAIlB,OAAO,IAAX;AACA,YAAIqB,OAAOD,MAAME,WAAN,EAAX;AACAL,gBAAQC,GAAR,CAAYG,IAAZ;;AAEA,YAAIS,UAAUT,IAAd;AACA;AACA;AACA,YAAIS,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAaU,KAAjC,EAAuC;AACnChD,8BAAkBiD,OAAlB,CAA0BF,QAAQT,IAAR,CAAaU,KAAvC;AACA/B,iBAAKQ,QAAL,CAAczB,kBAAkB0B,OAAlB,EAAd;;AAEA;AACA,gBAAG7B,OAAOqD,eAAV,EAA0B;AACtBrD,uBAAOqD,eAAP,GAAyB,KAAzB;AACA,oBAAIC,OAAO,EAAX;AACA,oBAAIC,OAAO;AACPC,0BAAK,OADE;AAEPC,0BAAK;AAFE,iBAAX;AAIAH,qBAAKI,IAAL,CAAUH,IAAV;AACAnD,8BAAcuD,eAAd,CAA8BL,IAA9B;AACH;AACJ;AACD;AACA,YAAIJ,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAamB,MAAjC,EAAwC;AACpCzD,8BAAkB0D,SAAlB,CAA4BX,QAAQT,IAAR,CAAamB,MAAzC;AACAxC,iBAAKU,SAAL,CAAe3B,kBAAkB4B,SAAlB,EAAf;AACH;AACD;AACA,YAAImB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAaqB,OAAjC,EAAyC;AACrC3D,8BAAkB4D,UAAlB,CAA6Bb,QAAQT,IAAR,CAAaqB,OAA1C;AACH;AACD;AACA,YAAIZ,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAauB,WAAjC,EAA6C;AACzC7D,8BAAkB8D,aAAlB,CAAgCf,QAAQT,IAAR,CAAauB,WAA7C;AACH;AACD;AACA,YAAId,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAayB,wBAAjC,EAA0D;AACtD/D,8BAAkBgE,eAAlB,CAAkCjB,QAAQT,IAAR,CAAayB,wBAA/C;AACH;AACD;AACA,YAAIhB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAa2B,0BAAjC,EAA4D;AACxDjE,8BAAkBkE,gBAAlB,CAAmCnB,QAAQT,IAAR,CAAa2B,0BAAhD;AACH;;AAED;AACA,YAAIlB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAa6B,YAAjC,EAA8C;AAC1CnE,8BAAkBoE,cAAlB,CAAiCrB,QAAQT,IAAR,CAAa6B,YAA9C;AACH;AACD;AACA,YAAIpB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAa+B,aAAjC,EAA+C;AAC3CrE,8BAAkBsE,eAAlB,CAAkCvB,QAAQT,IAAR,CAAa+B,aAA/C;AACH;AACD;AACA,YAAItB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAaiC,aAAjC,EAA+C;AAC3CvE,8BAAkBwE,eAAlB,CAAkCzB,QAAQT,IAAR,CAAaiC,aAA/C;AACH;AACD;AACA,YAAIxB,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAamC,WAAjC,EAA6C;AACzCzE,8BAAkB0E,aAAlB,CAAgC3B,QAAQT,IAAR,CAAamC,WAA7C;AACH;AACD;AACA,YAAI1B,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAaqC,SAAjC,EAA2C;AACvC3E,8BAAkB4E,YAAlB,CAA+B7B,QAAQT,IAAR,CAAaqC,SAA5C;AACH;AACD;AACA,YAAI5B,QAAQT,IAAR,IAAgBS,QAAQT,IAAR,CAAauC,SAAjC,EAA2C;AACvC7E,8BAAkB8E,YAAlB,CAA+B/B,QAAQT,IAAR,CAAauC,SAA5C;AACH;AACJ,KA/HI;AAgIL3D,cAhIK,wBAgIO;AACR,YAAID,OAAO,IAAX;AACC;AACA,YAAI8D,SAAOlF,OAAOmF,MAAP,CAAcC,SAAzB;;AAEA,YAAGF,UAAQ,EAAX,EAAc;AACX,gBAAIG,UAAU,cAAd;AACA,gBAAGlF,kBAAkBmF,SAAlB,MAAiC,CAApC,EAAsC;AAClCD,0BAAU,YAAV;AACH;AACDhF,eAAGkF,MAAH,CAAUC,OAAV,CAAkBH,OAAlB,EAA0BhF,GAAGoF,WAA7B,EAAyC,UAASC,GAAT,EAAaC,WAAb,EAAyB;AAC9DvE,qBAAKV,OAAL,CAAakF,YAAb,CAA0BvF,GAAGQ,MAA7B,EAAqC8E,WAArC,GAAmDA,WAAnD;AACH,aAFD;AAGA;AACH;;AAEDT,iBAASA,SAAS,YAAlB;AACA7E,WAAGkF,MAAH,CAAUM,IAAV,CAAeX,MAAf,EAAuB,UAASQ,GAAT,EAAcI,OAAd,EAAsB;AACzC1E,iBAAKV,OAAL,CAAakF,YAAb,CAA0BvF,GAAGQ,MAA7B,EAAqC8E,WAArC,GAAmD,IAAItF,GAAGoF,WAAP,CAAmBK,OAAnB,CAAnD;AACH,SAFD;AAGH,KApJI;AAqJLtE,eArJK,uBAqJOuE,IArJP,EAqJY;AACZ;AACA,aAAKjF,UAAL,CAAgBkF,MAAhB,GAAyBD,IAAzB;AACJ,KAxJI;AAyJLrE,YAzJK,oBAyJIuE,EAzJJ,EAyJO;AACR;AACA,aAAKjF,WAAL,CAAiBgF,MAAjB,GAA0BC,EAA1B;AACH,KA5JI;AA6JLrE,YA7JK,oBA6JIsE,MA7JJ,EA6JW;AACZ;AACA,YAAGA,UAAU,QAAb,EAAsB;AAClBA,qBAASC,KAAKC,KAAL,CAAWF,SAAS,KAApB,CAAT;AACA,iBAAKjF,WAAL,CAAiB+E,MAAjB,GAA0B,KAAGE,MAAH,GAAU,GAApC;AACH,SAHD,MAGK;AACD,iBAAKjF,WAAL,CAAiB+E,MAAjB,GAA0B,KAAGE,MAA7B;AACH;AAEJ,KAtKI;AAuKLpE,aAvKK,qBAuKKoE,MAvKL,EAuKY;AACb;AACA,YAAGA,UAAU,QAAb,EAAsB;AAClBA,qBAASC,KAAKC,KAAL,CAAWF,SAAS,KAApB,CAAT;AACA,iBAAKhF,YAAL,CAAkB8E,MAAlB,GAA2B,KAAGE,MAAH,GAAU,GAArC;AACH,SAHD,MAGK;AACD,iBAAKhF,YAAL,CAAkB8E,MAAlB,GAA2B,KAAGE,MAA9B;AACH;AACJ,KA/KI;;AAgLL;AACAG,aAjLK,uBAiLM;AACP,YAAI9C,OAAO,MAAX;AACAnD,sBAAckG,cAAd,CAA6B/C,IAA7B;AACAlD,WAAGwC,EAAH,CAAMC,QAAN,CAAeyD,OAAf,CAAuB,QAAvB;AACH;AArLI;AAsLL;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAlMJ","file":"topBarControl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\nvar config = require(\"config\");\nvar EventHelper = require(\"EventHelper\");\nvar PlayerDetailModel = require(\"PlayerDetailModel\");\nvar dialogManager = require(\"dialogManager\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        headImg : {\n            default : null,\n            type : cc.Sprite\n        },\n        playerName : {\n            default : null,\n            type : cc.Label\n        },\n        playerLevel : {\n            default : null,\n            type : cc.Label\n        },\n        playerLedou : {\n            default : null,\n            type : cc.Label\n        },\n        playerLeQuan : {\n            default : null,\n            type : cc.Label\n        }\n    },\n    // onLoad () {},\n    start () {\n        var self = this;\n        self.setHeadUrl();\n        var nickname = PlayerDetailModel.getNickName();\n        self.setNickName(config.parseString(nickname,5));\n        self.setLevel(PlayerDetailModel.getTitle());\n        self.setLeDou(PlayerDetailModel.getCoin());\n        self.setLuQuan(PlayerDetailModel.getCoupon());\n\n        EventHelper.AddCustomEvent(config.MyNode,\"RefreshDataResult\",self.onRefreshDataResult,self);\n        EventHelper.AddCustomEvent(config.MyNode,\"RepeatLogin\",self.onRepeatLogin,self);   \n        // EventHelper.AddCustomEvent(config.MyNode,\"ShareWxResResult\",self.onShareWxResResult,self);\n    },\n    onDestroy(){\n        console.log(\" topBar Destroy\");\n        var self = this;\n        EventHelper.RemoveCustomEvent(config.MyNode,\"RefreshDataResult\",self.onRefreshDataResult,self);\n        EventHelper.RemoveCustomEvent(config.MyNode,\"RepeatLogin\",self.onRepeatLogin,self);\n    },\n    onRepeatLogin(event){\n        console.log(\"您的账号已经在其他地方登陆！\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n        dialogManager.showCommonDialog(\"提示\",\"您的账号已经在其他地方登陆！\",function(){\n            self.isShow = false;\n            cc.vv.audioMgr.stopMusic();\n            cc.director.loadScene(\"LoadingScene\");\n        });\n    },\n    onRefreshDataResult(event){\n        console.log(\"刷新用户信息数据1111------\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n\n        var payload = data;\n        // var model = app:getModel(\"PlayerDetailModel\")\n        //用户乐豆数\n        if (payload.data && payload.data.coins){\n            PlayerDetailModel.setCoin(payload.data.coins)\n            self.setLeDou(PlayerDetailModel.getCoin());\n\n            //分享获取乐豆\n            if(config.leDouShareSucss){\n                config.leDouShareSucss = false;\n                var list = [];\n                var args = {\n                    arg1:\"ledou\",\n                    arg2:1000,\n                }\n                list.push(args);\n                dialogManager.showAnimGetProp(list);\n            }\n        }\n        //用户奖券数\n        if (payload.data && payload.data.coupon){\n            PlayerDetailModel.setCoupon(payload.data.coupon)\n            self.setLuQuan(PlayerDetailModel.getCoupon());\n        }\n        //用户抽奖数\n        if (payload.data && payload.data.lottery){\n            PlayerDetailModel.setLottery(payload.data.lottery)\n        }\n        //未读邮件数\n        if (payload.data && payload.data.mail_unread){\n            PlayerDetailModel.setMailUnread(payload.data.mail_unread)\n        }\n        //未领取任务数\n        if (payload.data && payload.data.weichatgame_task_unaward){\n            PlayerDetailModel.setTaskUnReward(payload.data.weichatgame_task_unaward)\n        }\n        //未领取分享数\n        if (payload.data && payload.data.weichatgame_invite_unaward){\n            PlayerDetailModel.setShareUnReward(payload.data.weichatgame_invite_unaward)\n        }\n\n        //0不可签到, 1可以签到\n        if (payload.data && payload.data.checkin_undo){\n            PlayerDetailModel.setCheckinUndo(payload.data.checkin_undo)\n        }\n        //可领奖的每日任务数\n        if (payload.data && payload.data.task1_unaward){\n            PlayerDetailModel.setTask1Unaward(payload.data.task1_unaward);\n        }\n        //可领奖的成长任务数\n        if (payload.data && payload.data.task2_unaward){\n            PlayerDetailModel.setTask2Unaward(payload.data.task2_unaward);\n        }\n        //充值奖励利率\n        if (payload.data && payload.data.charge_rate){\n            PlayerDetailModel.setChargeRate(payload.data.charge_rate);\n        }\n        //皮肤\n        if (payload.data && payload.data.propDress){\n            PlayerDetailModel.setPropDress(payload.data.propDress);\n        }\n        //道具\n        if (payload.data && payload.data.propItems){\n            PlayerDetailModel.setPropItems(payload.data.propItems);\n        }\n    },\n    setHeadUrl(){\n        var self = this;\n         //设置微信头像\n         var imgUrl=config.wxInfo.avatarUrl;\n\n         if(imgUrl==\"\"){\n            var headUrl = \"p_head_woman\";\n            if(PlayerDetailModel.getGender() == 1){\n                headUrl = \"p_head_man\";\n            }\n            cc.loader.loadRes(headUrl,cc.SpriteFrame,function(err,spriteFrame){\n                self.headImg.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n            });\n            return;\n        }\n\n        imgUrl = imgUrl + \"?aa=aa.jpg\";\n        cc.loader.load(imgUrl, function(err, texture){\n            self.headImg.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n        });\n    },\n    setNickName(name){\n         //修改昵称\n         this.playerName.string = name;\n    },\n    setLevel(lv){\n        //修改等级\n        this.playerLevel.string = lv;\n    },\n    setLeDou(number){\n        //修改乐豆数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLedou.string = \"\"+number+\"万\";\n        }else{\n            this.playerLedou.string = \"\"+number;\n        }\n        \n    },\n    setLuQuan(number){\n        //修改乐券数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLeQuan.string = \"\"+number+\"万\";\n        }else{\n            this.playerLeQuan.string = \"\"+number;\n        }\n    },\n    //点击头像\n    headClick(){\n        var args = \"hall\";\n        dialogManager.showPlayerInfo(args);\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    // onShareWxResResult(event){\n    //     console.log(\"微信分享成功发送结果------\");\n    //     // var self = this;\n    //     var response = event.getUserData();\n    //     console.log(response);\n\n    //     if(config.leQuanShareSucss){\n    //         GameNetMgr.sendRequest(\"System\",\"ShareWxRes\",5);\n    //     }else if(config.leDouShareSucss){\n    //         GameNetMgr.sendRequest(\"System\",\"ShareWxRes\",3);\n    //         GameNetMgr.sendRequest(\"Game\", \"openReliefTip\", {});\n    //     }\n    // },\n});\n"]}