{"version":3,"sources":["../../../../../assets/Script/gameNetwork/assets/Script/gameNetwork/ByteArray.js"],"names":["config","require","ByteArray","PACKET_HEADER_LENGTH","encodeUtf8","text","code","encodeURIComponent","bytes","i","length","c","charAt","hex","hexVal","parseInt","push","charCodeAt","decodeUtf8","encoded","toString","decodeURIComponent","getHead","len","cmd","_bytes","allBytes","arr","complementByte","j","strHed","complement","strByte","substring","getView","params","info","JSON","stringify","buffer","ArrayBuffer","view","DataView","setUint32","head","setUint8","module","exports"],"mappings":"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","file":"ByteArray.js","sourceRoot":"../../../../../assets/Script/gameNetwork","sourcesContent":["\nvar config = require(\"config\");\n\nvar ByteArray = {};\n\nByteArray.PACKET_HEADER_LENGTH = 16;\n\nByteArray.encodeUtf8 = function(text){\n    const code = encodeURIComponent(text);\n    const bytes = [];\n    for (var i = 0; i < code.length; i++) {\n        const c = code.charAt(i);\n        if (c === '%') {\n            const hex = code.charAt(i + 1) + code.charAt(i + 2);\n            const hexVal = parseInt(hex, 16);\n            bytes.push(hexVal);\n            i += 2;\n        } else bytes.push(c.charCodeAt(0));\n    }\n    return bytes;\n}\n\nByteArray.decodeUtf8 = function(bytes){\n    var encoded = \"\";\n    for (var i = 0; i < bytes.length; i++) {\n        encoded += '%' + bytes[i].toString(16);\n    }\n    // console.log(encoded);\n    return decodeURIComponent(encoded);\n}\n\nByteArray.getHead = function(len,cmd){ \n    var _bytes = [len,cmd,1,2];\n    var allBytes = [];\n    for(var i=0;i<_bytes.length;i++){\n        var arr = ByteArray.complementByte(_bytes[i]);\n        for(var j = 0;j<arr.length;j++){\n            allBytes.push(arr[j]);\n        }   \n    }\n    return allBytes;\n}\n\nByteArray.complementByte = function(code){\n    var strHed = code.toString(2);\n    //补齐32位\n    var complement = \"\";\n    for(var i = 0;i<32-strHed.length;i++){\n        complement+=\"0\";\n    }\n    var allBytes = complement+strHed;\n    var arr = [];\n    for(var i = 0;i<32;i+=8){\n        var strByte = allBytes.substring(i,i+8);\n        arr.push(parseInt(strByte,2))\n    }\n    return arr;\n}\n\n//获取数据视图\nByteArray.getView = function(params,cmd){\n    var info = JSON.stringify(params);\n    var bytes = ByteArray.encodeUtf8(info);\n    var buffer = new ArrayBuffer(bytes.length+ByteArray.PACKET_HEADER_LENGTH);\n    var view = new DataView(buffer);\n    view.setUint32(0, bytes.length+ByteArray.PACKET_HEADER_LENGTH);\n    var head = ByteArray.getHead(bytes.length+ByteArray.PACKET_HEADER_LENGTH,cmd);\n    for(var i=0;i<head.length;i++){\n        view.setUint8(i, head[i]);\n    }\n    for (var i = 0; i < bytes.length; i++) {\n        view.setUint8(i+ByteArray.PACKET_HEADER_LENGTH, bytes[i]);\n    }\n    return view;\n}\n\n\n\nmodule.exports = ByteArray;\n"]}