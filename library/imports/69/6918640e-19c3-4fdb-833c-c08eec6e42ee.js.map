{"version":3,"sources":["../../../../../assets/Script/dialog/assets/Script/dialog/shareControl.js"],"names":["PlayerDetailModel","require","dialogManager","config","GameNetMgr","EventHelper","cc","Class","extends","Component","properties","btnNode_1","default","type","Button","opentype","btnNode_2","btnNode_3","btnNode_4","btnNode_5","btnNode_get","start","self","sendRequest","AddCustomEvent","MyNode","onShareInfoResult","onShareGetResult","pHeads","labCoins","i","pHead","labCoin","_pHead","node","getChildByName","getComponent","Sprite","_labCoin","Label","push","enabled","closeClick","console","log","destroy","RemoveCustomEvent","vv","audioMgr","playSFX","btnClick","loader","loadRes","err","data","wx","shareAppMessage","title","imageUrl","url","query","uid","getClick","event","response","getUserData","list","length","img","setHeadUrl","award","string","award_desc","awarded","showCommonDialog","setShareUnReward","imgUrl","headImg","load","texture","spriteFrame","SpriteFrame"],"mappings":"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","file":"shareControl.js","sourceRoot":"../../../../../assets/Script/dialog","sourcesContent":["var PlayerDetailModel = require(\"PlayerDetailModel\");\nvar dialogManager = require(\"dialogManager\");\nvar config = require(\"config\");\nvar GameNetMgr = require(\"GameNetMgr\");\nvar EventHelper = require(\"EventHelper\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        btnNode_1 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_2 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_3 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_4 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_5 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_get : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n    },\n    start () {\n        var self = this;\n        GameNetMgr.sendRequest(\"System\",\"ShareInfo\");\n        EventHelper.AddCustomEvent(config.MyNode,\"ShareInfoResult\",self.onShareInfoResult,self);\n        EventHelper.AddCustomEvent(config.MyNode,\"ShareGetResult\",self.onShareGetResult,self);\n\n        // var nodeHeads = [];//头像节点\n        this.pHeads = [];//微信头像\n        this.labCoins = [];//奖励乐豆\n\n        for(var i=1;i<=5;i++){\n            // var nodeHead = \"shareDialog/\"+\"head_\"+i;\n            var pHead = \"head_\"+i;//+\"/mask/defult_head\";\n            var labCoin = \"label_\"+i;\n            var _pHead = this.node.getChildByName(pHead).getChildByName(\"mask\").getChildByName(\"defult_head\").getComponent(cc.Sprite);\n            var _labCoin = this.node.getChildByName(labCoin).getComponent(cc.Label);//.getComponent(cc.Label);\n            this.pHeads.push(_pHead);\n            this.labCoins.push(_labCoin);\n            _pHead.enabled = false;\n        }\n\n    },   \n    closeClick(){\n        var self = this;\n        console.log(\"close click\");\n        this.node.destroy();\n        EventHelper.RemoveCustomEvent(config.MyNode,\"ShareInfoResult\",self.onShareInfoResult,self);\n        EventHelper.RemoveCustomEvent(config.MyNode,\"ShareGetResult\",self.onShareGetResult,self);\n\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnClick(){\n        // shareImg\n        // var width  = cc.director.getWinSize().width;\n        // var height  = cc.director.getWinSize().height;\n        // canvas.toTempFilePath({\n        //     x: 0,\n        //     y: 0,\n        //     width: width,\n        //     height: height,\n        //     destWidth: width,\n        //     destHeight: height,\n        //     success (res) {\n        //         //.可以保存该截屏图片\n        //         console.log(res)\n        //         wx.shareAppMessage({\n        //             title: \"有乐斗地主等你来战！\",\n        //             imageUrl: res.tempFilePath,\n        //             query : \"key=\"+PlayerDetailModel.uid,\n        //         })\n        //     }\n        // });\n\n        cc.loader.loadRes(\"shareImg\",function(err,data){\n            wx.shareAppMessage({\n                title: \"小伙伴们帮帮忙，小手一点助我拿豆！\",\n                imageUrl: data.url,\n                query : \"key=\"+PlayerDetailModel.uid,\n            })\n        });\n\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    getClick(){\n        console.log(\"-------get\");\n        GameNetMgr.sendRequest(\"System\",\"ShareGet\");\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    onShareInfoResult(event){\n        var response = event.getUserData();\n        console.log(response);\n\n        // \"img\":头像\n        // \"nickname\":昵称\n        // \"uid\":uid\n        // \"award\":0没有领取1已领取\n        // \"award_info\":[ //奖品\n        //   \"gold\":金币\n\n        var list = response.data.list;\n        for(var i=0;i<list.length;i++){\n            if(list[i].img){\n                this.pHeads[i].enabled = true;\n                this.setHeadUrl(list[i].img,this.pHeads[i]);\n            }\n            if(list[i].award){\n                if(list[i].award == 0){\n                    this.labCoins[i].string = \"\"+list[i].award_desc;\n                }else{\n                    this.labCoins[i].string = \"已领取\";\n                }\n            }\n        }\n    },\n    onShareGetResult(event){\n        var response = event.getUserData();\n        console.log(response);\n        var self = this;\n        var awarded = response.data.awarded;\n        dialogManager.showCommonDialog(\"温馨提示\",response.data.award_desc,function(){\n            if(awarded<5&&response.data.award.length==0){\n                self.btnClick();\n                for(var i=0;i<awarded;i++){\n                    self.labCoins[i].string = \"已领取\";\n                }\n            }\n        });\n\n        PlayerDetailModel.setShareUnReward(0);\n    },\n    \n    setHeadUrl(imgUrl,headImg){\n        // console.log(headImg);\n        // console.log(imgUrl);\n        //设置微信头像\n        imgUrl = imgUrl + \"?aa=aa.jpg\";\n        cc.loader.load(imgUrl, function(err, texture){\n            headImg.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n        });\n    },\n});\n"]}