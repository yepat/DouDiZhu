{"version":3,"sources":["HallLayerControl.js"],"names":["dialogManager","require","PlayerDetailModel","EventHelper","config","GameNetMgr","Events","cc","Class","extends","Component","properties","taskTip","default","type","Sprite","mailTip","shareTip","start","self","enabled","getTaskUnReward","getMailUnread","getShareUnReward","AddCustomEvent","MyNode","onRefreshDataResult","continueRoomId","callFunc","arg","roomId","sendRequest","delay","delayTime","node","runAction","sequence","Network","LoginRoomResult","onLoginRoomResult","firstLogin","showShareDialog","onDestroy","console","log","event","data","getUserData","handleLoginRoomResult","preloadNextScene","RemoveCustomEvent","director","preloadScene","loadScene","payload","mail_unread","weichatgame_task_unaward","weichatgame_invite_unaward","btnSetClick","showSetDialog","vv","audioMgr","playSFX","btnTaskClick","showTaskDialog","btnEmailClick","showEmailDialog","btnBagClick","showBagDialog","btnShopClick","btnShareClick","args","parseInt","m_sended","m_totalTimes","m_curTimes","sended","totalTimes","curTimes","tableInfo","IsContinueGaming"],"mappings":"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","file":"HallLayerControl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\nvar dialogManager = require(\"dialogManager\");\nvar PlayerDetailModel = require(\"PlayerDetailModel\");\nvar EventHelper = require(\"EventHelper\");\nvar config = require(\"config\");\nvar GameNetMgr = require(\"GameNetMgr\");\nvar Events = require(\"Events\");\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        taskTip : {\n            default : null,\n            type : cc.Sprite\n        },\n        mailTip : {\n            default : null,\n            type : cc.Sprite\n        },\n        shareTip : {\n            default : null,\n            type : cc.Sprite\n        },\n    },\n    // onLoad () {},\n    start () {\n        var self = this;\n        this.taskTip.enabled = false;\n        this.mailTip.enabled = false;\n        this.shareTip.enabled = false;\n\n        if(PlayerDetailModel.getTaskUnReward()>0){\n            this.taskTip.enabled = true;\n        }\n        if(PlayerDetailModel.getMailUnread()>0){\n            this.mailTip.enabled = true;\n        }\n        if(PlayerDetailModel.getShareUnReward()>0){\n            this.shareTip.enabled = true;\n        }\n\n        EventHelper.AddCustomEvent(config.MyNode,\"RefreshDataResult\",self.onRefreshDataResult,self);\n\n        if(PlayerDetailModel.continueRoomId != 0){\n            var callFunc = cc.callFunc(function(){\n                var arg = {};\n                arg.roomId = PlayerDetailModel.continueRoomId;\n                GameNetMgr.sendRequest(\"Game\", \"loginRoom\", arg);\n                // self.preloadNextScene();\n             });\n             var delay = cc.delayTime(0.5);\n             this.node.runAction(cc.sequence(delay,callFunc));\n             EventHelper.AddCustomEvent(config.MyNode,Events.Network.LoginRoomResult,self.onLoginRoomResult,self);\n        }\n\n        // var index = config.getRandom(1);\n        // console.log(\"index=\",index);\n\n\n        //第一次登陆弹出分享窗口\n        if(config.firstLogin){\n            config.firstLogin = false;\n            dialogManager.showShareDialog();\n        }\n    },\n    onDestroy(){\n        console.log(\" HallLayer Destroy\");\n    },\n    onLoginRoomResult(event){\n        var self = this;\n        console.log(\"登陆房间回掉---\");\n        var data = event.getUserData();\n        // console.log(data);\n        self.handleLoginRoomResult(data); \n    },\n    preloadNextScene(){\n        var self = this;\n        EventHelper.RemoveCustomEvent(config.MyNode,Events.Network.LoginRoomResult,self.onLoginRoomResult,self);\n        // EventHelper.RemoveCustomEvent(config.MyNode,\"OpenRechargeTipResult\",self.onOpenRechargeTipResult,self);\n        cc.director.preloadScene(\"GameScene\", function () {\n            cc.log(\"Next scene preloaded\");\n            cc.director.loadScene(\"GameScene\");\n        });\n    },\n    onRefreshDataResult(event){\n        var payload = event.getUserData();\n        console.log(\"onRefreshDataResult  33333\")\n        //未读邮件数\n        if (payload.data){\n            if(payload.data.mail_unread>0){\n                this.mailTip.enabled = true;\n            }else{\n                this.mailTip.enabled = false;\n            }\n        }\n        //未领取任务数\n        if (payload.data){\n            if(payload.data.weichatgame_task_unaward>0){\n                this.taskTip.enabled = true;\n            }else{\n                this.taskTip.enabled = false;\n            }\n        }\n        //未领取分享数\n        if (payload.data){\n            if(payload.data.weichatgame_invite_unaward>0){\n                this.shareTip.enabled = true;\n            }else{\n                this.shareTip.enabled = false;\n            }\n        }\n    },\n    btnSetClick(){\n        console.log(\"btnSetClick\");\n        dialogManager.showSetDialog();\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnTaskClick(){\n        console.log(\"btnTaskClick\");\n        dialogManager.showTaskDialog();\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnEmailClick(){\n        console.log(\"btnEmailClick\");\n        dialogManager.showEmailDialog();\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnBagClick(){\n        console.log(\"btnBagClick\");\n        dialogManager.showBagDialog();\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnShopClick(){\n        console.log(\"btnShopClick\");\n        // dialogManager.showShopDialog();\n    },\n    btnShareClick(){\n        console.log(\"btnShareClick\");\n        dialogManager.showShareDialog();\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    handleLoginRoomResult(event){\n        console.log(\"--进入上局未完的普通牌桌>>>\");\n        var payload = event.payload;\n        var args = {};\n        args[\"baseCoins\"] = payload[\"data\"][\"baseCoins\"];\n        args[\"rate\"] = payload[\"data\"][\"rate\"];\n        args[\"limitCoins\"] = payload[\"data\"][\"limitCoins\"];\n        args[\"rake\"] = payload[\"data\"][\"rake\"];\n        args[\"roomId\"] = payload[\"data\"][\"roomId\"];\n        args[\"rateMax\"] = payload[\"data\"][\"rateMax\"];\n        args[\"enterLimit\"] = payload[\"data\"][\"enterLimit\"];\n        args[\"emoticon\"] = payload[\"data\"][\"emoticon\"];\n        args[\"emoticon_items\"] = payload[\"data\"][\"emoticon_items\"];\n        args[\"advert\"] = payload[\"data\"][\"advert\"]; //记牌器数据\n\n        if(payload[\"data\"][\"modelId\"]){\n            args[\"modelId\"] = payload[\"data\"][\"modelId\"];\n        }\n        args[\"buys\"] = payload[\"data\"][\"buys\"];\n        args[\"givecoins\"] = null;\n\n        if(payload[\"data\"][\"isContinue\"] && parseInt(payload[\"data\"][\"isContinue\"]) == 1){\n            args[\"isContinueGaming\"] = true\n        } \n        var m_sended = payload[\"data\"][\"sendCoins\"];\n        var m_totalTimes = payload[\"data\"][\"sendCoinsTimes\"];\n        var m_curTimes = payload[\"data\"][\"sendCoinsTimesToday\"];\n\n        if(m_sended && m_sended > 0){\n            args[\"givecoins\"] = {\n                sended : m_sended,\n                totalTimes : m_totalTimes,\n                curTimes : m_curTimes,\n            };\n            //刷新用户乐豆乐券\n            console.log(\"刷新用户乐豆乐券\");\n        }\n        config.tableInfo = args;\n\n        console.log(config.tableInfo);\n\n        config.IsContinueGaming = 1;\n        this.preloadNextScene();\n    }\n});\n"]}