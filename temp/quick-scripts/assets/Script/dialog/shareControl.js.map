{"version":3,"sources":["shareControl.js"],"names":["PlayerDetailModel","require","dialogManager","config","GameNetMgr","EventHelper","cc","Class","extends","Component","properties","btnNode_1","default","type","Button","opentype","btnNode_2","btnNode_3","btnNode_4","btnNode_5","btnNode_get","start","self","sendRequest","AddCustomEvent","MyNode","onShareInfoResult","onShareGetResult","pHeads","labCoins","palyerNum","i","pHead","labCoin","_pHead","node","getChildByName","getComponent","Sprite","_labCoin","Label","push","enabled","closeClick","console","log","destroy","RemoveCustomEvent","vv","audioMgr","playSFX","btnClick","_palyerNum","index","getRandom","shareTxt","shareImg","getShareImgPath","wx","shareAppMessage","title","imageUrl","query","uid","success","res","fail","getClick","event","response","getUserData","list","data","length","img","setHeadUrl","award","string","award_desc","awarded","coins","args","arg1","arg2","coupon","showAnimGetProp","showCommonDialog","setShareUnReward","imgUrl","headImg","loader","load","err","texture","spriteFrame","SpriteFrame"],"mappings":"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","file":"shareControl.js","sourceRoot":"../../../../../assets/Script/dialog","sourcesContent":["var PlayerDetailModel = require(\"PlayerDetailModel\");\nvar dialogManager = require(\"dialogManager\");\nvar config = require(\"config\");\nvar GameNetMgr = require(\"GameNetMgr\");\nvar EventHelper = require(\"EventHelper\");\ncc.Class({\n    extends: cc.Component,\n    properties: {\n        btnNode_1 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_2 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_3 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_4 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_5 : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n        btnNode_get : {\n            default : null,\n            type : cc.Button,\n            opentype : \"share\",\n        },\n    },\n    start () {\n        var self = this;\n        GameNetMgr.sendRequest(\"System\",\"ShareInfo\");\n        EventHelper.AddCustomEvent(config.MyNode,\"ShareInfoResult\",self.onShareInfoResult,self);\n        EventHelper.AddCustomEvent(config.MyNode,\"ShareGetResult\",self.onShareGetResult,self);\n\n        // var nodeHeads = [];//头像节点\n        this.pHeads = [];//微信头像\n        this.labCoins = [];//奖励乐豆\n        this.palyerNum = 0;//邀请玩家人数\n\n        for(var i=1;i<=5;i++){\n            // var nodeHead = \"shareDialog/\"+\"head_\"+i;\n            var pHead = \"head_\"+i;//+\"/mask/defult_head\";\n            var labCoin = \"label_\"+i;\n            var _pHead = this.node.getChildByName(pHead).getChildByName(\"mask\").getChildByName(\"defult_head\").getComponent(cc.Sprite);\n            var _labCoin = this.node.getChildByName(labCoin).getComponent(cc.Label);//.getComponent(cc.Label);\n            this.pHeads.push(_pHead);\n            this.labCoins.push(_labCoin);\n            _pHead.enabled = false;\n        }\n\n    },   \n    closeClick(){\n        var self = this;\n        console.log(\"close click\");\n        this.node.destroy();\n        EventHelper.RemoveCustomEvent(config.MyNode,\"ShareInfoResult\",self.onShareInfoResult,self);\n        EventHelper.RemoveCustomEvent(config.MyNode,\"ShareGetResult\",self.onShareGetResult,self);\n\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    btnClick(){\n        // shareImg\n        // var width  = cc.director.getWinSize().width;\n        // var height  = cc.director.getWinSize().height;\n        // canvas.toTempFilePath({\n        //     x: 0,\n        //     y: 0,\n        //     width: width,\n        //     height: height,\n        //     destWidth: width,\n        //     destHeight: height,\n        //     success (res) {\n        //         //.可以保存该截屏图片\n        //         console.log(res)\n        //         wx.shareAppMessage({\n        //             title: \"有乐斗地主等你来战！\",\n        //             imageUrl: res.tempFilePath,\n        //             query : \"key=\"+PlayerDetailModel.uid,\n        //         })\n        //     }\n        // });\n\n        //\"小伙伴们帮帮忙，小手一点助我拿豆！\"\n        var _palyerNum = 5 - this.palyerNum;\n\n        console.log(\"xxxxxxx\",_palyerNum);\n\n        if(_palyerNum>0){\n        }else{\n            return;\n        }\n\n        var index = config.getRandom(1);\n        var shareTxt = config.shareTxt[\"share\"][index];\n        if(index == 1){\n            shareTxt = \"【仅剩\"+_palyerNum+\"人】麻烦你啦，点击帮我拆礼包吧！\";\n        }\n        console.log(\">>>>shareTxt:\",shareTxt);\n\n        var shareImg = config.getShareImgPath(\"share\");\n        console.log(\">>>shareImg:\",shareImg);\n\n        // cc.loader.loadRes(\"shareImg\",function(err,data){\n            wx.shareAppMessage({\n                title: shareTxt,\n                imageUrl: shareImg,\n                query : \"key=\"+PlayerDetailModel.uid,\n                success(res){\n                    console.log(\"---转发成功!!!\");\n                    console.log(res);\n                    GameNetMgr.sendRequest(\"System\",\"ShareWxRes\",2);\n                },\n                fail(res){\n                    console.log(\"---转发失败!!!\")\n                } \n            })\n        // });\n\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    getClick(){\n        console.log(\"-------get\");\n        GameNetMgr.sendRequest(\"System\",\"ShareGet\");\n        cc.vv.audioMgr.playSFX(\"SpecOk\");\n    },\n    onShareInfoResult(event){\n        var response = event.getUserData();\n        console.log(response);\n\n        // \"img\":头像\n        // \"nickname\":昵称\n        // \"uid\":uid\n        // \"award\":0没有领取1已领取\n        // \"award_info\":[ //奖品\n        // \"gold\":金币\n\n        var list = response.data.list;\n        this.palyerNum = 0;\n        for(var i=0;i<list.length;i++){\n            if(list[i].img){\n                this.pHeads[i].enabled = true;\n                this.setHeadUrl(list[i].img,this.pHeads[i]);\n                this.palyerNum++;\n            }\n            if(list[i].award){\n                if(list[i].award == 0){\n                    this.labCoins[i].string = \"\"+list[i].award_desc;\n                }else{\n                    this.labCoins[i].string = \"已领取\";\n                }\n            }\n        }\n    },\n    onShareGetResult(event){\n        var response = event.getUserData();\n        console.log(response);\n        var self = this;\n        var awarded = response.data.awarded;\n        // dialogManager.showCommonDialog(\"温馨提示\",response.data.award_desc,function(){\n        //     if(awarded<5&&response.data.award.length==0){\n        //         self.btnClick();\n        //         for(var i=0;i<awarded;i++){\n        //             self.labCoins[i].string = \"已领取\";\n        //         }\n        //     }\n        // });\n        var award = response.data.award;\n        var list = [];\n        if(award.coins){\n            var args = {\n                arg1:\"ledou\",\n                arg2:award.coins,\n            }\n            list.push(args);\n        } \n        if(award.coupon){\n            var args = {\n                arg1:\"lequan\",\n                arg2:award.coupon,\n            }\n            list.push(args);\n        } \n        if(list.length>0){\n            dialogManager.showAnimGetProp(list,function(){\n                if(awarded<=5){\n                    // self.btnClick();\n                    for(var i=0;i<awarded;i++){\n                        self.labCoins[i].string = \"已领取\";\n                    }\n                }\n            });\n        }else{\n            if(awarded==5){\n                dialogManager.showCommonDialog(\"温馨提示\",response.data.award_desc);\n            }else{\n                // self.btnClick();\n                dialogManager.showCommonDialog(\"温馨提示\",response.data.award_desc,function(){\n                    self.btnClick();\n                });\n            }\n        }\n        \n        PlayerDetailModel.setShareUnReward(0);\n    },\n    \n    setHeadUrl(imgUrl,headImg){\n        // console.log(headImg);\n        // console.log(imgUrl);\n        //设置微信头像\n        imgUrl = imgUrl + \"?aa=aa.jpg\";\n        cc.loader.load(imgUrl, function(err, texture){\n            headImg.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n        });\n    },\n});\n"]}