{"version":3,"sources":["ByteArray.js"],"names":["config","require","ByteArray","PACKET_HEADER_LENGTH","encodeUtf8","text","code","encodeURIComponent","bytes","i","length","c","charAt","hex","hexVal","parseInt","push","charCodeAt","decodeUtf8","encoded","toString","decodeURIComponent","getHead","len","cmd","_bytes","strBytes","str16","xx_Bytes","j","getView","params","info","JSON","stringify","buffer","ArrayBuffer","view","DataView","setUint32","head","setUint8","module","exports"],"mappings":"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","file":"ByteArray.js","sourceRoot":"../../../../../assets/Script/gameNetwork","sourcesContent":["\nvar config = require(\"config\");\n\nvar ByteArray = {};\n\nByteArray.PACKET_HEADER_LENGTH = 16;\n\nByteArray.encodeUtf8 = function(text){\n    const code = encodeURIComponent(text);\n    const bytes = [];\n    for (var i = 0; i < code.length; i++) {\n        const c = code.charAt(i);\n        if (c === '%') {\n            const hex = code.charAt(i + 1) + code.charAt(i + 2);\n            const hexVal = parseInt(hex, 16);\n            bytes.push(hexVal);\n            i += 2;\n        } else bytes.push(c.charCodeAt(0));\n    }\n    return bytes;\n}\n\nByteArray.decodeUtf8 = function(bytes){\n    var encoded = \"\";\n    for (var i = 0; i < bytes.length; i++) {\n        encoded += '%' + bytes[i].toString(16);\n    }\n    // console.log(encoded);\n    return decodeURIComponent(encoded);\n}\n\n//前16个字节 len字节长度 cmd 大协议号\nByteArray.getHead = function(len,cmd){ \n    var _bytes = [len,cmd,1,2];\n    var strBytes = [];\n    for(var i=0;i<_bytes.length;i++){\n        // console.log(_bytes[i].toString(16));\n        var str16 = _bytes[i].toString(16);\n        // (parseInt(str16,16)\n        strBytes.push(parseInt(str16,16));\n    }\n    var xx_Bytes = [];\n    for(var i=0;i<strBytes.length;i++){\n        for(var j=0;j<3;j++){\n            xx_Bytes.push(0);\n        }\n        xx_Bytes.push(strBytes[i]);\n    }\n    // console.log(xx_Bytes);\n    return xx_Bytes;\n}\n\n//获取数据视图\nByteArray.getView = function(params,cmd){\n    var info = JSON.stringify(params);\n    var bytes = ByteArray.encodeUtf8(info);\n    var buffer = new ArrayBuffer(bytes.length+ByteArray.PACKET_HEADER_LENGTH);\n    var view = new DataView(buffer);\n    view.setUint32(0, bytes.length+ByteArray.PACKET_HEADER_LENGTH);\n    var head = ByteArray.getHead(bytes.length+ByteArray.PACKET_HEADER_LENGTH,cmd);\n    for(var i=0;i<head.length;i++){\n        view.setUint8(i, head[i]);\n    }\n    for (var i = 0; i < bytes.length; i++) {\n        view.setUint8(i+ByteArray.PACKET_HEADER_LENGTH, bytes[i]);\n    }\n    return view;\n}\n\n\n\nmodule.exports = ByteArray;\n"]}