{"version":3,"sources":["ByteArray.js"],"names":["config","require","ByteArray","PACKET_HEADER_LENGTH","encodeUtf8","text","code","encodeURIComponent","bytes","i","length","c","charAt","hex","hexVal","parseInt","push","charCodeAt","decodeUtf8","encoded","toString","decodeURIComponent","getHead","len","cmd","_bytes","strBytes","str16","xx_Bytes","j","getView","info","buffer","ArrayBuffer","view","DataView","setUint32","head","setUint8","module","exports"],"mappings":"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","file":"ByteArray.js","sourceRoot":"../../../../../assets/Script/gameNetwork","sourcesContent":["\r\nvar config = require(\"config\");\r\n\r\nvar ByteArray = {};\r\n\r\nByteArray.PACKET_HEADER_LENGTH = 16;\r\n\r\nByteArray.encodeUtf8 = function(text){\r\n    const code = encodeURIComponent(text);\r\n    const bytes = [];\r\n    for (var i = 0; i < code.length; i++) {\r\n        const c = code.charAt(i);\r\n        if (c === '%') {\r\n            const hex = code.charAt(i + 1) + code.charAt(i + 2);\r\n            const hexVal = parseInt(hex, 16);\r\n            bytes.push(hexVal);\r\n            i += 2;\r\n        } else bytes.push(c.charCodeAt(0));\r\n    }\r\n    return bytes;\r\n}\r\n\r\nByteArray.decodeUtf8 = function(bytes){\r\n    var encoded = \"\";\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        encoded += '%' + bytes[i].toString(16);\r\n    }\r\n    // console.log(encoded);\r\n    return decodeURIComponent(encoded);\r\n}\r\n\r\n//前16个字节 len字节长度 cmd 大协议号\r\nByteArray.getHead = function(len,cmd){ \r\n    var _bytes = [len,cmd,1,2];\r\n    var strBytes = [];\r\n    for(var i=0;i<_bytes.length;i++){\r\n        // console.log(_bytes[i].toString(16));\r\n        var str16 = _bytes[i].toString(16);\r\n        // (parseInt(str16,16)\r\n        strBytes.push(parseInt(str16,16));\r\n    }\r\n    var xx_Bytes = [];\r\n    for(var i=0;i<strBytes.length;i++){\r\n        for(var j=0;j<3;j++){\r\n            xx_Bytes.push(0);\r\n        }\r\n        xx_Bytes.push(strBytes[i]);\r\n    }\r\n    // console.log(xx_Bytes);\r\n    return xx_Bytes;\r\n}\r\n\r\n//获取数据视图\r\nByteArray.getView = function(info,cmd){\r\n    var bytes = ByteArray.encodeUtf8(info);\r\n    var buffer = new ArrayBuffer(bytes.length+ByteArray.PACKET_HEADER_LENGTH);\r\n    var view = new DataView(buffer);\r\n    view.setUint32(0, bytes.length+ByteArray.PACKET_HEADER_LENGTH);\r\n    var head = ByteArray.getHead(bytes.length+ByteArray.PACKET_HEADER_LENGTH,cmd);\r\n    for(var i=0;i<head.length;i++){\r\n        view.setUint8(i, head[i]);\r\n    }\r\n    for (var i = 0; i < bytes.length; i++) {\r\n        view.setUint8(i+ByteArray.PACKET_HEADER_LENGTH, bytes[i]);\r\n    }\r\n    return view;\r\n}\r\n\r\n\r\n\r\nmodule.exports = ByteArray;\r\n"]}