{"version":3,"sources":["topBarControl.js"],"names":["config","require","EventHelper","PlayerDetailModel","dialogManager","cc","Class","extends","Component","properties","headImg","default","type","Sprite","playerName","Label","playerLevel","playerLedou","playerLeQuan","start","self","setHeadUrl","setNickName","getNickName","setLevel","getTitle","setLeDou","getCoin","setLuQuan","getCoupon","AddCustomEvent","MyNode","onRefreshDataResult","onRepeatLogin","event","console","log","data","getUserData","showCommonDialog","isShow","director","loadScene","payload","coins","setCoin","coupon","setCoupon","lottery","setLottery","mail_unread","setMailUnread","weichatgame_task_unaward","setTaskUnReward","weichatgame_invite_unaward","setShareUnReward","checkin_undo","setCheckinUndo","task1_unaward","setTask1Unaward","task2_unaward","setTask2Unaward","charge_rate","setChargeRate","propDress","setPropDress","propItems","setPropItems","imgUrl","wxInfo","avatarUrl","headUrl","getGender","loader","loadRes","SpriteFrame","err","spriteFrame","getComponent","load","texture","name","string","lv","number","Math","floor"],"mappings":"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","file":"topBarControl.js","sourceRoot":"../../../../assets/Script","sourcesContent":["\nvar config = require(\"config\");\nvar EventHelper = require(\"EventHelper\");\nvar PlayerDetailModel = require(\"PlayerDetailModel\");\nvar dialogManager = require(\"dialogManager\");\n\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        headImg : {\n            default : null,\n            type : cc.Sprite\n        },\n        playerName : {\n            default : null,\n            type : cc.Label\n        },\n        playerLevel : {\n            default : null,\n            type : cc.Label\n        },\n        playerLedou : {\n            default : null,\n            type : cc.Label\n        },\n        playerLeQuan : {\n            default : null,\n            type : cc.Label\n        }\n    },\n    // onLoad () {},\n    start () {\n        var self = this;\n        self.setHeadUrl();\n        self.setNickName(PlayerDetailModel.getNickName());\n        self.setLevel(PlayerDetailModel.getTitle());\n        self.setLeDou(PlayerDetailModel.getCoin());\n        self.setLuQuan(PlayerDetailModel.getCoupon());\n\n        EventHelper.AddCustomEvent(config.MyNode,\"RefreshDataResult\",self.onRefreshDataResult,self);\n        EventHelper.AddCustomEvent(config.MyNode,\"RepeatLogin\",self.onRepeatLogin,self);   \n        \n    },\n    onRepeatLogin(event){\n        console.log(\"您的账号已经在其他地方登陆！\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n        dialogManager.showCommonDialog(\"提示\",\"您的账号已经在其他地方登陆！\",function(){\n            self.isShow = false;\n            cc.director.loadScene(\"LoadingScene\");\n        });\n    },\n    onRefreshDataResult(event){\n        console.log(\"刷新用户信息数据1111------\");\n        var self = this;\n        var data = event.getUserData();\n        console.log(data);\n\n        var payload = data;\n        // var model = app:getModel(\"PlayerDetailModel\")\n        //用户乐豆数\n        if (payload.data && payload.data.coins){\n            PlayerDetailModel.setCoin(payload.data.coins)\n            self.setLeDou(PlayerDetailModel.getCoin());\n        }\n        //用户奖券数\n        if (payload.data && payload.data.coupon){\n            PlayerDetailModel.setCoupon(payload.data.coupon)\n            self.setLuQuan(PlayerDetailModel.getCoupon());\n        }\n        //用户抽奖数\n        if (payload.data && payload.data.lottery){\n            PlayerDetailModel.setLottery(payload.data.lottery)\n        }\n        //未读邮件数\n        if (payload.data && payload.data.mail_unread){\n            PlayerDetailModel.setMailUnread(payload.data.mail_unread)\n        }\n        //未领取任务数\n        if (payload.data && payload.data.weichatgame_task_unaward){\n            PlayerDetailModel.setTaskUnReward(payload.data.weichatgame_task_unaward)\n        }\n        //未领取分享数\n        if (payload.data && payload.data.weichatgame_invite_unaward){\n            PlayerDetailModel.setShareUnReward(payload.data.weichatgame_invite_unaward)\n        }\n\n        //0不可签到, 1可以签到\n        if (payload.data && payload.data.checkin_undo){\n            PlayerDetailModel.setCheckinUndo(payload.data.checkin_undo)\n        }\n        //可领奖的每日任务数\n        if (payload.data && payload.data.task1_unaward){\n            PlayerDetailModel.setTask1Unaward(payload.data.task1_unaward);\n        }\n        //可领奖的成长任务数\n        if (payload.data && payload.data.task2_unaward){\n            PlayerDetailModel.setTask2Unaward(payload.data.task2_unaward);\n        }\n        //充值奖励利率\n        if (payload.data && payload.data.charge_rate){\n            PlayerDetailModel.setChargeRate(payload.data.charge_rate);\n        }\n        //皮肤\n        if (payload.data && payload.data.propDress){\n            PlayerDetailModel.setPropDress(payload.data.propDress);\n        }\n        //道具\n        if (payload.data && payload.data.propItems){\n            PlayerDetailModel.setPropItems(payload.data.propItems);\n        }\n    },\n    setHeadUrl(){\n        var self = this;\n         //设置微信头像\n         var imgUrl=config.wxInfo.avatarUrl;\n\n         if(imgUrl==\"\"){\n            var headUrl = \"p_head_woman\";\n            if(PlayerDetailModel.getGender() == 1){\n                headUrl = \"p_head_man\";\n            }\n            cc.loader.loadRes(headUrl,cc.SpriteFrame,function(err,spriteFrame){\n                self.headImg.getComponent(cc.Sprite).spriteFrame = spriteFrame;\n            });\n            return;\n        }\n\n\n         imgUrl = imgUrl + \"?aa=aa.jpg\";\n         cc.loader.load(imgUrl, function(err, texture){\n             self.headImg.getComponent(cc.Sprite).spriteFrame = new cc.SpriteFrame(texture);\n         });\n    },\n    setNickName(name){\n         //修改昵称\n         this.playerName.string = name;\n    },\n    setLevel(lv){\n        //修改等级\n        this.playerLevel.string = lv;\n    },\n    setLeDou(number){\n        //修改乐豆数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLedou.string = \"\"+number+\"万\";\n        }else{\n            this.playerLedou.string = \"\"+number;\n        }\n        \n    },\n    setLuQuan(number){\n        //修改乐券数\n        if(number >= 10000000){\n            number = Math.floor(number / 10000)\n            this.playerLeQuan.string = \"\"+number+\"万\";\n        }else{\n            this.playerLeQuan.string = \"\"+number;\n        }\n    }\n});\n"]}